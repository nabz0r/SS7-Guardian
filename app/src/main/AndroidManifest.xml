<?xml version="1.0" encoding="utf-8"?>
<!--
  SS7 Guardian - Android Manifest
  ================================
  
  Required Permissions:
  - ACCESS_FINE_LOCATION: Required to read cell tower info (CID, LAC)
  - ACCESS_COARSE_LOCATION: Fallback for cell tower positioning
  - READ_PHONE_STATE: Required for TelephonyCallback (network type monitoring)
  - RECEIVE_SMS: Required to detect Class 0/Type 0 silent SMS attacks
  - FOREGROUND_SERVICE: Required for persistent background monitoring
  - FOREGROUND_SERVICE_LOCATION: Android 10+ requirement for location in service
  - POST_NOTIFICATIONS: Android 13+ requirement for alerts
  - RECEIVE_BOOT_COMPLETED: Auto-start monitoring after device reboot
  
  Security Notes:
  - allowBackup=false: Prevents extraction of cell tower database
  - exported=false on service: Prevents other apps from starting/stopping
  - BootReceiver is exported to receive system broadcasts only
-->
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">

    <!-- ====================================================================
         Core Permissions - Required for cell tower monitoring
         ==================================================================== -->
    
    <!-- Location is required to get CellInfo data from TelephonyManager -->
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
    <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
    
    <!-- Phone state is needed for TelephonyCallback network changes -->
    <uses-permission android:name="android.permission.READ_PHONE_STATE" />
    
    <!-- SMS permissions for detecting silent SMS attacks -->
    <uses-permission android:name="android.permission.RECEIVE_SMS" />
    
    <!-- ====================================================================
         Service Permissions - Required for background monitoring
         ==================================================================== -->
    
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_LOCATION" />
    
    <!-- ====================================================================
         Notification & Boot Permissions
         ==================================================================== -->
    
    <!-- Android 13+ requires explicit notification permission -->
    <uses-permission android:name="android.permission.POST_NOTIFICATIONS" />
    
    <!-- Auto-start after device boot -->
    <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />
    
    <!-- ====================================================================
         Optional: 2G Blocking (Android 12+)
         ==================================================================== -->
    
    <!-- Uncomment if implementing 2G blocking feature
    <uses-permission android:name="android.permission.MODIFY_PHONE_STATE"
        tools:ignore="ProtectedPermissions" />
    -->

    <application
        android:name=".SS7GuardianApp"
        android:allowBackup="false"
        android:icon="@drawable/ic_shield"
        android:label="@string/app_name"
        android:roundIcon="@drawable/ic_shield"
        android:supportsRtl="true"
        android:theme="@style/Theme.SS7Guardian"
        tools:targetApi="34">

        <!-- ================================================================
             Main Activity - Dashboard and controls
             ================================================================ -->
        <activity
            android:name=".ui.MainActivity"
            android:exported="true"
            android:launchMode="singleTop">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
            
            <!-- Handle notification tap to open app -->
            <intent-filter>
                <action android:name="android.intent.action.VIEW" />
            </intent-filter>
        </activity>

        <!-- ================================================================
             Guardian Service - Core monitoring engine
             
             foregroundServiceType="location" is required for:
             - Continuous cell tower monitoring
             - Location-based cell tower database
             ================================================================ -->
        <service
            android:name=".service.GuardianService"
            android:exported="false"
            android:foregroundServiceType="location"
            android:description="@string/channel_service_desc" />

        <!-- ================================================================
             Boot Receiver - Auto-start on device boot
             
             exported=true is required to receive BOOT_COMPLETED
             but is safe as it only listens for system broadcasts
             ================================================================ -->
        <receiver 
            android:name=".receiver.BootReceiver" 
            android:exported="true"
            android:directBootAware="true">
            <intent-filter>
                <action android:name="android.intent.action.BOOT_COMPLETED" />
                <action android:name="android.intent.action.LOCKED_BOOT_COMPLETED" />
            </intent-filter>
        </receiver>

        <!-- ================================================================
             SMS Receiver - Detect silent SMS attacks
             
             Priority set high to intercept Class 0 SMS before they're
             displayed or processed by other apps
             ================================================================ -->
        <receiver
            android:name=".receiver.SmsReceiver"
            android:exported="true"
            android:permission="android.permission.BROADCAST_SMS">
            <intent-filter android:priority="999">
                <action android:name="android.provider.Telephony.SMS_RECEIVED" />
                <action android:name="android.provider.Telephony.WAP_PUSH_RECEIVED" />
                <data android:mimeType="application/vnd.wap.mms-message" />
            </intent-filter>
        </receiver>

    </application>
</manifest>